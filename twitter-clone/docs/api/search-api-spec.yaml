openapi: 3.0.3
info:
  title: Twitter Clone Search API
  description: |
    Comprehensive search API for Twitter Clone application.
    Supports searching tweets, users, and hashtags with advanced filtering,
    autocomplete suggestions, and trending search queries.
  version: 1.0.0
  contact:
    name: API Support
    email: api-support@twitterclone.example

servers:
  - url: https://api.twitterclone.example/v1
    description: Production server
  - url: https://staging-api.twitterclone.example/v1
    description: Staging server
  - url: http://localhost:8000/v1
    description: Local development server

tags:
  - name: Search
    description: Primary search operations
  - name: Autocomplete
    description: Search suggestions and autocomplete
  - name: Trending
    description: Trending searches and topics

paths:
  /search:
    get:
      tags:
        - Search
      summary: Search across tweets, users, and hashtags
      description: |
        Performs a full-text search across tweets, users, and/or hashtags.
        Supports filtering, sorting, and pagination.
        Results include highlighted matching text.
      operationId: search
      parameters:
        - name: q
          in: query
          required: true
          description: Search query string (minimum 1 character)
          schema:
            type: string
            minLength: 1
            maxLength: 280
          example: "machine learning"

        - name: type
          in: query
          required: false
          description: Type of content to search
          schema:
            type: string
            enum: [all, tweets, users, hashtags]
            default: all

        - name: limit
          in: query
          required: false
          description: Maximum number of results per type
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20

        - name: offset
          in: query
          required: false
          description: Pagination offset
          schema:
            type: integer
            minimum: 0
            default: 0

        - name: sort
          in: query
          required: false
          description: Sort order for results
          schema:
            type: string
            enum: [relevance, recent, popular]
            default: relevance

        - name: from
          in: query
          required: false
          description: Filter results from this date (ISO 8601)
          schema:
            type: string
            format: date-time
          example: "2025-10-01T00:00:00Z"

        - name: to
          in: query
          required: false
          description: Filter results to this date (ISO 8601)
          schema:
            type: string
            format: date-time
          example: "2025-10-13T23:59:59Z"

        - name: verified
          in: query
          required: false
          description: Filter to verified users/authors only
          schema:
            type: boolean

        - name: has_media
          in: query
          required: false
          description: Filter tweets with media only
          schema:
            type: boolean

        - name: min_likes
          in: query
          required: false
          description: Minimum like count for tweets
          schema:
            type: integer
            minimum: 0

        - name: min_retweets
          in: query
          required: false
          description: Minimum retweet count for tweets
          schema:
            type: integer
            minimum: 0

      responses:
        '200':
          description: Successful search
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchResponse'
              examples:
                tweets_search:
                  summary: Search for tweets
                  value:
                    query: "machine learning"
                    type: "tweets"
                    total: 1547
                    took_ms: 23
                    results:
                      tweets:
                        - id: "123456789"
                          content: "Just published my new article on machine learning algorithms!"
                          content_highlighted: "Just published my new article on <mark>machine</mark> <mark>learning</mark> algorithms!"
                          author:
                            id: "user_123"
                            username: "ml_expert"
                            display_name: "ML Expert"
                            avatar_url: "https://cdn.example.com/avatar.jpg"
                            is_verified: true
                          engagement:
                            likes: 245
                            retweets: 67
                            replies: 23
                          created_at: "2025-10-13T14:30:00Z"
                          has_media: false
                          hashtags: ["machinelearning", "AI", "datascience"]
                    pagination:
                      limit: 20
                      offset: 0
                      has_more: true

        '400':
          description: Bad request (invalid parameters)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "bad_request"
                message: "Query parameter 'q' is required"
                details:
                  field: "q"
                  reason: "missing_required_parameter"

        '429':
          description: Rate limit exceeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "rate_limit_exceeded"
                message: "Too many requests. Please try again in 60 seconds."
                details:
                  retry_after: 60

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

      security:
        - BearerAuth: []
        - {}  # Also allow anonymous access

  /search/autocomplete:
    get:
      tags:
        - Autocomplete
      summary: Get autocomplete suggestions
      description: |
        Returns autocomplete suggestions based on partial query.
        Includes recent searches, matching users, and hashtags.
        Optimized for low latency (< 50ms).
      operationId: autocomplete
      parameters:
        - name: q
          in: query
          required: true
          description: Partial search query
          schema:
            type: string
            minLength: 1
            maxLength: 100
          example: "mach"

        - name: type
          in: query
          required: false
          description: Type of suggestions to return
          schema:
            type: string
            enum: [all, queries, users, hashtags]
            default: all

        - name: limit
          in: query
          required: false
          description: Maximum number of suggestions
          schema:
            type: integer
            minimum: 1
            maximum: 20
            default: 8

      responses:
        '200':
          description: Successful autocomplete
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AutocompleteResponse'
              example:
                query: "mach"
                suggestions:
                  queries:
                    - text: "machine learning"
                      highlighted: "<mark>mach</mark>ine learning"
                      type: "trending"
                    - text: "machine learning tutorial"
                      highlighted: "<mark>mach</mark>ine learning tutorial"
                      type: "recent"
                  users:
                    - id: "user_123"
                      username: "ml_expert"
                      display_name: "ML Expert"
                      avatar_url: "https://cdn.example.com/avatar.jpg"
                      is_verified: true
                      follower_count: 45230
                  hashtags:
                    - tag: "machinelearning"
                      highlighted: "<mark>mach</mark>inelearning"
                      tweet_count: 1234567
                      is_trending: true
                took_ms: 15

        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

      security:
        - BearerAuth: []
        - {}

  /search/trending:
    get:
      tags:
        - Trending
      summary: Get trending search queries
      description: |
        Returns currently trending search queries with volume and growth metrics.
        Updated every 15 minutes.
      operationId: getTrending
      parameters:
        - name: limit
          in: query
          required: false
          description: Maximum number of trending items
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 10

        - name: location
          in: query
          required: false
          description: Geographic location for localized trends
          schema:
            type: string
          example: "US"

      responses:
        '200':
          description: Successful retrieval of trends
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TrendingResponse'
              example:
                trends:
                  - query: "machine learning"
                    volume: 45230
                    growth_rate: 125.5
                    category: "Technology"
                    related_hashtags: ["machinelearning", "AI", "tech"]
                  - query: "climate change"
                    volume: 38940
                    growth_rate: 87.3
                    category: "News"
                    related_hashtags: ["climatechange", "environment"]
                updated_at: "2025-10-13T15:00:00Z"

        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

      security:
        - BearerAuth: []
        - {}

components:
  schemas:
    SearchResponse:
      type: object
      required:
        - query
        - type
        - total
        - took_ms
        - results
        - pagination
      properties:
        query:
          type: string
          description: The search query that was executed
        type:
          type: string
          enum: [all, tweets, users, hashtags]
          description: Type of search performed
        total:
          type: integer
          description: Total number of results found
        took_ms:
          type: integer
          description: Time taken to execute search in milliseconds
        results:
          type: object
          properties:
            tweets:
              type: array
              items:
                $ref: '#/components/schemas/TweetSearchResult'
            users:
              type: array
              items:
                $ref: '#/components/schemas/UserSearchResult'
            hashtags:
              type: array
              items:
                $ref: '#/components/schemas/HashtagSearchResult'
        pagination:
          $ref: '#/components/schemas/Pagination'

    TweetSearchResult:
      type: object
      required:
        - id
        - content
        - content_highlighted
        - author
        - engagement
        - created_at
        - has_media
      properties:
        id:
          type: string
          description: Unique tweet identifier
        content:
          type: string
          description: Original tweet content
          maxLength: 280
        content_highlighted:
          type: string
          description: Tweet content with matching terms wrapped in <mark> tags
        author:
          $ref: '#/components/schemas/AuthorInfo'
        engagement:
          $ref: '#/components/schemas/TweetEngagement'
        created_at:
          type: string
          format: date-time
          description: Tweet creation timestamp
        has_media:
          type: boolean
          description: Whether tweet contains media
        media_urls:
          type: array
          items:
            type: string
            format: uri
          description: URLs of media attachments (if any)
        hashtags:
          type: array
          items:
            type: string
          description: Hashtags mentioned in tweet

    UserSearchResult:
      type: object
      required:
        - id
        - username
        - display_name
        - avatar_url
        - is_verified
        - stats
      properties:
        id:
          type: string
          description: Unique user identifier
        username:
          type: string
          description: User's handle (without @)
        username_highlighted:
          type: string
          description: Username with matching terms highlighted
        display_name:
          type: string
          description: User's display name
        display_name_highlighted:
          type: string
          description: Display name with matching terms highlighted
        bio:
          type: string
          description: User's bio/description
        bio_highlighted:
          type: string
          description: Bio with matching terms highlighted
        avatar_url:
          type: string
          format: uri
          description: URL to user's avatar image
        is_verified:
          type: boolean
          description: Whether user is verified
        stats:
          $ref: '#/components/schemas/UserStats'
        is_following:
          type: boolean
          description: Whether authenticated user follows this user (requires auth)

    HashtagSearchResult:
      type: object
      required:
        - tag
        - tag_highlighted
        - tweet_count
        - trending_score
        - is_trending
      properties:
        tag:
          type: string
          description: Hashtag text (without #)
        tag_highlighted:
          type: string
          description: Hashtag with matching terms highlighted
        tweet_count:
          type: integer
          description: Total number of tweets using this hashtag
        trending_score:
          type: number
          format: float
          description: Calculated trending score (0-100)
        is_trending:
          type: boolean
          description: Whether hashtag is currently trending
        hourly_count:
          type: integer
          description: Number of tweets in last hour

    AuthorInfo:
      type: object
      required:
        - id
        - username
        - display_name
        - avatar_url
        - is_verified
      properties:
        id:
          type: string
        username:
          type: string
        display_name:
          type: string
        avatar_url:
          type: string
          format: uri
        is_verified:
          type: boolean

    TweetEngagement:
      type: object
      required:
        - likes
        - retweets
        - replies
      properties:
        likes:
          type: integer
          minimum: 0
        retweets:
          type: integer
          minimum: 0
        replies:
          type: integer
          minimum: 0

    UserStats:
      type: object
      required:
        - followers
        - following
        - tweets
      properties:
        followers:
          type: integer
          minimum: 0
        following:
          type: integer
          minimum: 0
        tweets:
          type: integer
          minimum: 0

    Pagination:
      type: object
      required:
        - limit
        - offset
        - has_more
      properties:
        limit:
          type: integer
          description: Number of results per page
        offset:
          type: integer
          description: Current offset
        has_more:
          type: boolean
          description: Whether more results are available

    AutocompleteResponse:
      type: object
      required:
        - query
        - suggestions
        - took_ms
      properties:
        query:
          type: string
          description: The partial query used for autocomplete
        suggestions:
          type: object
          properties:
            queries:
              type: array
              items:
                $ref: '#/components/schemas/QuerySuggestion'
            users:
              type: array
              items:
                $ref: '#/components/schemas/UserSuggestion'
            hashtags:
              type: array
              items:
                $ref: '#/components/schemas/HashtagSuggestion'
        took_ms:
          type: integer
          description: Time taken to generate suggestions in milliseconds

    QuerySuggestion:
      type: object
      required:
        - text
        - highlighted
        - type
      properties:
        text:
          type: string
          description: Suggested query text
        highlighted:
          type: string
          description: Query with matching portion highlighted
        type:
          type: string
          enum: [recent, trending, personalized]
          description: Type of suggestion

    UserSuggestion:
      type: object
      required:
        - id
        - username
        - display_name
        - avatar_url
        - is_verified
        - follower_count
      properties:
        id:
          type: string
        username:
          type: string
        display_name:
          type: string
        avatar_url:
          type: string
          format: uri
        is_verified:
          type: boolean
        follower_count:
          type: integer

    HashtagSuggestion:
      type: object
      required:
        - tag
        - highlighted
        - tweet_count
        - is_trending
      properties:
        tag:
          type: string
        highlighted:
          type: string
        tweet_count:
          type: integer
        is_trending:
          type: boolean

    TrendingResponse:
      type: object
      required:
        - trends
        - updated_at
      properties:
        trends:
          type: array
          items:
            $ref: '#/components/schemas/TrendingItem'
        updated_at:
          type: string
          format: date-time
          description: When trending data was last updated

    TrendingItem:
      type: object
      required:
        - query
        - volume
        - growth_rate
      properties:
        query:
          type: string
          description: Trending search query
        volume:
          type: integer
          description: Number of searches
        growth_rate:
          type: number
          format: float
          description: Percentage increase in searches
        category:
          type: string
          description: Auto-categorized topic area
        related_hashtags:
          type: array
          items:
            type: string
          description: Related trending hashtags

    ErrorResponse:
      type: object
      required:
        - error
        - message
      properties:
        error:
          type: string
          description: Error code
          enum:
            - bad_request
            - unauthorized
            - forbidden
            - not_found
            - rate_limit_exceeded
            - internal_server_error
        message:
          type: string
          description: Human-readable error message
        details:
          type: object
          description: Additional error details
          additionalProperties: true

  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        JWT token for authenticated requests.
        Include in Authorization header as: Bearer <token>

security:
  - BearerAuth: []
  - {}  # Allow unauthenticated access for most endpoints
